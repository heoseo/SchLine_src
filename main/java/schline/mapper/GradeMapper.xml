<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
  <mapper namespace="schline.GradeDTOImpl">
  		
  	  <!-- attendance_tb 와 video_tb 조인 -->
	  <select id="listAttendance" resultType="schline.AttendanceDTO">
	 	select Tb.*, rownum rNum from (
		    select * from attendance_tb A
			inner join video_tb V on A.video_idx=V.video_idx
			where subject_idx = #{subject_idx} and user_id = #{user_id}
			order by A.video_idx asc   
		) Tb
	  </select>  
	  <!-- grade_tb 와 exam_tb 조인 -->
	  <select id="listGrade" resultType="schline.GradeDTO">
	 	select * from grade_tb G
		inner join exam_tb E on G.exam_idx=E.exam_idx
		where G.subject_idx = #{subject_idx} and user_id = #{user_id} and exam_scoring!=100
		order by E.exam_idx asc 
	  </select>
	    
	  <select id="Registrationgrade" resultType="schline.RegistrationDTO">
	 	update registration_tb 
		set grade_sub = #{grade_sub}
		where subject_idx=#{subject_idx} and user_id=#{user_id}
	  </select>  
	  
	  <select id="listInfo" resultType="schline.UserInfoDTO">
	 	select U.*, orga_name, expiration_date
		from user_tb U
		inner join organization_tb O on U.orga_id=O.orga_id
		where user_id = #{user_id}
	  </select>  
	  
	  <select id="RegistrationInfo" resultType="schline.UserInfoDTO">
	 	select U.user_id, U.subject_idx, U.user_name, regi_idx, grade_sub, subject_name, R.user_name
		from (select R.user_id, subject_idx, user_name, regi_idx, grade_sub
		from user_tb U
		inner join registration_tb R on U.user_id=R.user_id
		where U.user_id = #{user_id}) U
		inner join (select S.user_id, subject_idx, subject_name, user_name
		from user_tb U
		inner join subject_tb S on U.user_id=S.user_id) R  
		on U.subject_idx = R.subject_idx
		where U.user_id = #{user_id} 
	  </select>  
	  
	  
  </mapper>